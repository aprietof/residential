tinymce.PluginManager.add("octo_textcolor",function(o){function r(r){var e;return o.dom.getParents(o.selection.getStart(),function(o){var t;!e&&(t=jQuery(o).css("forecolor"==r?"color":"background-color"))&&(e=t)}),e}function e(r,e){o._scsColorPickerBookmark&&o.selection.moveToBookmark(o._scsColorPickerBookmark),o.formatter.apply(r,{value:e})}function t(o,r){e(o,r)}function c(o){if(o){if(o._items&&o._items.length)for(var r=0;r<o._items.length;r++){if(o._items[r]._classes&&o._items[r]._classes[0]&&"colorbutton"==o._items[r]._classes[0])return o._items[r];var e=c(o._items[r]);if(e)return e}return!1}}function n(o,e){e=e?e:r("forecolor"),o.css({"background-color":e})}var l,s;s=o.settings.textcolor_rows||5,l=o.settings.textcolor_cols||8,o.on("click",function(r){if(o.theme){var e=c(o.theme.panel);if(!e)return;var t=null;for(var l in e._elmCache){t=e._elmCache[l];break}n(jQuery(t).find(".scsColorpickerInput"))}}),o.on("BeforeRenderUI",function(o){var r=c(o.target.theme.panel);r&&setTimeout(function(){var o=null;for(var e in r._elmCache){o=r._elmCache[e];break}jQuery(o).html('<div class="scsColorpickerInputShell"><div class="scsColorpickerInput"></div></div>'),n(jQuery(o).find(".scsColorpickerInput"))},10)}),jQuery(function(){o.addButton("forecolor",{type:"panelbutton",tooltip:"Text color",format:"forecolor",classes:"colorbutton",panel:{role:"application",ariaRemember:!0,html:"",classes:"colorpanel",border:1,onpostrender:function(e){if(!e.control._scsInited){e.control._scsFirstTimeChange=!0;var c=jQuery("#"+e.control._id);c.html("<div class='wpColorPicker'></div>"),c.attr("bottom-panel","cp");var n=jQuery.extend({appendTo:c.find(".wpColorPicker").get(0),convertCallback:function(r){var c="rgba("+r.webSmart.r+","+r.webSmart.g+","+r.webSmart.b+","+r.alpha+")";e.control._scsFirstTimeChange=!1,e.control._scsFirstTimeChange||t("forecolor",c),o._scsColorPickerBookmark=o.selection.getBookmark(2,!0);var n=c;jQuery("#"+e.control._parent._id+" .scsColorpickerInput").css("background-color",n),jQuery("#"+e.control._parent._id).trigger("colorpickersliders.updateColor",n)}},g_scsColorPickerOptions),l=new ColorPicker(n);l.setColor(r("forecolor"),"rgb"),e.control._scsInited=!0}},onshow:function(e){o._scsColorPickerBookmark=o.selection.getBookmark(2,!0);var t=r("forecolor");jQuery("#"+e.control._parent._id).trigger("colorpickersliders.updateColor",t),jQuery("#"+e.control._id).removeClass("mce-container");var c=jQuery("#"+e.control.rootControl._id);c.hasClass("cp-hideArrow")||c.addClass("cp-hideArrow")}}})})});